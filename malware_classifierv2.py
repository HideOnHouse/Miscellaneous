import os
import json

import pickle
from matplotlib import pyplot as plt
import numpy as np

if __name__ == '__main__':
    mal_path = r'C:\-\-\-\-\-'
    tables_kasper = [{}, {}, {}]
    tables_ahnlab = [{}, {}]
    table_kasper = {}
    table_ahnlab = {}
    for path, dirs, files in os.walk(mal_path):
        for file in files:
            if file.count('.json') != 0:
                with open(os.path.join(path, file), 'r') as f:
                    json_data = json.load(f)
                    try:
                        if json_data['tags'].count('macros') != 0:
                            pass
                        else:
                            if json_data['scans']['Kaspersky']['detected']:
                                kasper = json_data['scans']['Kaspersky']['result'].split('.')
                                for i in range(3):
                                    temp = ''
                                    for j in range(i + 1):
                                        temp += kasper[j] + ' '
                                    if table_kasper.get(temp) is None:
                                        table_kasper[temp] = [file]
                                    else:
                                        table_kasper[temp].append(file)
                            if json_data['scans']['AhnLab-V3']['detected']:
                                ahnlab = json_data['scans']['AhnLab-V3']['result'].split('/')
                                for i in range(2):
                                    temp = ''
                                    for j in range(i + 1):
                                        temp += ahnlab[j] + ' '
                                    if table_ahnlab.get(temp) is None:
                                        table_ahnlab[temp] = [file]
                                    else:
                                        table_ahnlab[temp].append(file)
                    except Exception as e:
                        print(file, e, 'not found')
    tables = [table_kasper, table_ahnlab]

    for item in table_kasper:
        print(item)
    # for i in range(2):
    #     for j in tables[i].keys():
    #         if i == 0:
    #             tables_kasper[len(j.split(' ')) - 2][j] = tables[i][j]
    #         else:
    #             tables_ahnlab[len(j.split(' ')) - 2][j] = tables[i][j]
    # tables_of_tables = [tables_kasper, tables_ahnlab]


    file_name = 0
    # for tables in tables_of_tables:
    #     for table in tables:
    #         for key in table.keys():
    #             print(key + '\n-->', table[key])
    #
    #         plt.figure(figsize=(20, 10))
    #         plt.bar(table.keys(), list(len(x) for x in table.values()), color=['slateblue', 'hotpink', 'coral'])
    #         plt.xticks(rotation=90)
    #         plt.savefig(str(file_name) + ".png", dpi=200)
    #         plt.show()
    #         file_name += 1
