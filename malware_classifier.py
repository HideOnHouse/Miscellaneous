import os

from matplotlib import pyplot as plt


def classifier(d):
    for subdir in os.listdir(d):
        if subdir == 'word':
            temp = os.path.join(d, subdir)
            for file in os.listdir(temp):
                type(file)
                if file.count('vba') != 0:
                    return 'macro'
                elif file == 'media':
                    for midi in os.listdir(os.path.join(d, temp, file)):
                        if midi.count('eps') != 0:
                            return 'cve'
                elif file == 'embeddings':
                    return 'ole'
    return 'unknown'


if __name__ == '__main__':
    macro = 0
    cve = 0
    ole = 0
    unknown = 0
    mal_path = r'C:\-\-\-\-\mal'
    for directory in os.listdir(mal_path):
        if directory.count('ì§€') != 0:
            continue
        try:
            res = classifier(os.path.join(mal_path, directory))
            if res == 'macro':
                macro += 1
            elif res == 'cve':
                cve += 1
            elif res == 'ole':
                ole += 1
            else:
                unknown += 1
            # os.rename(os.path.join(mal_path, directory), os.path.join(mal_path, res + '_' + directory))
        except Exception as e:
            print("error : ", e, directory)

    plt.bar(['macro(over 1000)', 'cve', 'ole', 'unknown'], [macro, cve, ole, unknown],
            color=['hotpink', 'slateblue', 'cornflowerblue', 'orange'])
    plt.ylim(0, 100)
    plt.show(dpi=200)
